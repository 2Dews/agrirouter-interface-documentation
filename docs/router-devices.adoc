= Router Devices
:imagesdir: ./../assets/images/
:toc:
:toc-title:
:toclevels: 4

== General function
Without router devices, an application would need to create multiple MQTT connections, which might cost quite a lot of resources. Therefore, router devices were implemented to allow routing multiple connections using one MQTT Broker.

When using MQTT for a Telemetry platform or a Farming software with multiple accounts, multiple MQTT Connections to different brokers would be required. To avoid this, agrirouter introduced so called **Router devices**


++++
<p align="center">
 <img src="./../assets/images/general/router-devices2.png"><br>
 <i>Using Router devices vs. not using router devices</i>
</p>
++++

++++
<p align="center">
 <img src="./../assets/images/general/router-devices1.png"><br>
 <i>Using router devices vs. communication using communication units</i>
</p>
++++

== Setup of router devices
Router devices can be set up and managed in the agrirouter developers UI
++++
<p align="center">
 <img src="./../assets/images/general/router-devices-screen1.png"><br>
 <i>Router device management in the agrirouter developers UI</i>
</p>
++++

When clicking on "New Router device", a new device is automatically generated. 
++++
<p align="center">
 <img src="./../assets/images/general/router-devices-screen2.png"><br>
 <i>Router device management in the agrirouter developers UI</i>
</p>
++++

To check the connection properties, click on "Connection Details".
++++
<p align="center">
 <img src="./../assets/images/general/router-devices-screen3.png"><br>
 <i>Router device details</i>
</p>
++++

The Certificate can be downloaded as PEM or P12 
++++
<p align="center">
 <img src="./../assets/images/general/router-devices-screen4.png"><br>
 <i>Download Certificate of router device</i>
</p>
++++

The file includes a JSON structure with all the information of the router device
[source,javascript]
----
{
    "authentication": {
        "type": "PEM",
        "secret": "s7jRq5jEvru914M3INJ6B0SluVYKHRmradqo",
        "certificate": "-----BEGIN ENCRYPTED PRIVATE KEY-----\n...\n-----END CERTIFICATE-----\n"
    },
    "deviceAlternateId": "d410a40c-920a-4af5-b4f8-80e45d2904f8",
    "connectionCriteria": {
        "clientId": "27b5ca3e-eb96-4b38-b586-61f9c6a724c4",
        "gatewayId": "2",
        "host": "dke-qa.eu10.cp.iot.sap",
        "port": 8883
    }
}
----

ConnectionCriteria and Authentication of a single endpoint can be replaced by the data given from the router device, so that every software component of a specific manufacturer can communicate using one router device, as long as all the relevant app instances are connected to the same server. There cannot be multiple connections using the same router device. 
