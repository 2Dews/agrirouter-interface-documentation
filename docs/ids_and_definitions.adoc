= IDs IDs IDs and which is which
:imagesdir: ./../assets/images/
:toc:
:toc-title:
:toclevels: 4

== Overview

The agrirouter api uses several IDs, which can be a little confusing. But don’t worry, here is a short description, which ID is used for what:

[cols="1,4",options="header",]
|======================================================================================================================================================================================================
|Name |Description
|accountId |A UUID describing the account of an end user. In one account, there can be multiple endpoints. One account however has one set of login credentials for the agrirouter
|applicationId |A UUID identifying an application regardless of the software version
|capabilityAlternateId |This is an Id that is delivered with the onboarding Request and has to be delivered with any message 
|certificationVersionId |A UUID representing a Certification for one app. an app has to be certified every time, a new version with changed capabilities against agrirouter are implemented.
|deviceAlternateId | The Id of the sender of a message
|endpointId |The endpointId is the unique address of an Application Instance on the agrirouter. It’s used to address the outbox and inbox and to directly address an endpoint from a different endpoint
|gatewayId |This is a simple enumeration to determine the protocol type of the communication. It’s either 2=MQTT or 3=REST
|sensorAlternateId | The Id of the recorder or the final receiver of a message
|======================================================================================================================================================================================================

== Ids in different Environments

It is important to keep in mind, that all Ids including applicationId or certificationVersionId might differ between QA and Productive environments.

== Practical differentiation between SensorAlternateId and DeviceAlternateId

sensorAlternateID and deviceAlternateId seem to be pretty equal, but the context differs. Here are some practical examples

=== An App sends a TaskData

For apps, the solution is pretty easy:

*sensorAlternateId = deviceAlternateId =* The endpoint representing the users account within the app.

[NOTE]
====
* For a telemetry platform, this is not correct, as the deviceAlternateId represents the telemetry platform itself whereas the sensorAlternateID describes the Virtual CU
* = does *NOT* mean, that the values are equal, but that they represent the same device
====


=== A CU sends a TaskData

Assume, a CU wants to send a taskdata.zip. Even though, it could include machine data - perhaps of multiple machines, the source of this taskdata is the CU. Therefore:

*sensorAlternateId = deviceAlternateId =* The CU

[NOTE]
====
* = does *NOT* mean, that the values are equal, but that they represent the same device
====

=== A telemetry Platform sends a TaskData from a virtual CU

The virtual CU as well as the telemetry platform are endpoints in the agrirouter. The platform wants to mark the virtual CU as source of the taskdataset.

*deviceAlternateId:* The telemetry platform is source of the message

*sensorAlternateId:* The virtual CU is source of the content of the message

== accountId

=== Description

The Unique Identifier for an endusers or developers account. Relevant for billing.

A UUID describing the account of an end user. In one account, there can be multiple endpoints. One account however has one set of login credentials for the agrirouter UI.

=== Where to find

==== As API/As Developer

The value is delivered with the authentication request. The value is also part of the billing metrics

==== As End User

The value can be found in the agrirouter UI endpoint Information.

++++
<p align="center">
<img src="./../assets/images/ig2/image49.png" width="512px" height="419px" /><br>
<i>agrirouter account ID</i>
</p>
++++



== applicationId

=== Description

A UUID identifying an application regardless of the software version.

=== Where to find

==== As API

The value cannot be found by the api, it has to be entered by the developer.

The developer can find the ID in his developer account:

==== As End User

The value can be found in the agrirouter UI endpoint Information

++++
<p align="center">
<img src="./../assets/images/ig2/image49.png" width="512px" height="419px" /><br>
<i>agrirouter endpoint software ID</i>
</p>
++++



== capabilityAlternateId

=== Description

This is a value required by the IoT Gateway of the agrirouter. It has no further meaning for the endpoint or app instance and shall just be delivered with requests.

=== Where to find

==== As API

The value is delivered with the onboarding request

==== As End User

The value cannot be found by an end user and has no meaning for him.

== certificationVersionId

=== Description

A UUID representing a certification for one app. an app has to be certified every time, a new version with changed capabilities against agrirouter are implemented.

=== Where to find

==== As API

The value cannot be found by the API. It has to be entered by the developer.

The developer can find the certificationVersionID in his endpoint software overview:

==== As End User

The value can be found in the agrirouter UI endpoint Information

++++
<p align="center">
<img src="./../assets/images/ig2/image49.png" width="512px" height="419px" /><br>
<i>agrirouter endpoint software version ID</i>
</p>
++++



== deviceAlternateId

=== Description

The deviceAlternateID represents the source of an agrirouter command, but not necessarily the source of the message itself. E.g. a telemetry platform would mark itself as deviceAlternateId and the virtual CU as source of message (content)

=== Where to find

==== As API

The value is delivered with any agrirouter message. To create message, take the context relevant endpointId. Context is the command, e.g. an onboarding request.

==== As End User

This ID cannot be found in the UI by the end user

== endpointId

=== Description

The endpointID is the unique address of an Application Instance on the agrirouter. It’s used to address the outbox and inbox and to directly address an endpoint from a different endpoint.

An endpoint can be an Application, a CU, a Virtual CU, a machine or a Telemetry platform.

=== Where to find

==== As API

The value is delivered with the onboarding request.

==== As End User

The value can be found in the agrirouter UI endpoint Information

++++
<p align="center">
<img src="./../assets/images/ig2/image49.png" width="512px" height="419px" /><br>
<i>agrirouter endpoint ID</i>
</p>
++++



== gatewayId

=== Description

The gatewayId is an enumeration to determine the used protocol for all communication after the onboarding:

2= MQTT

3=HTTP

=== Where to find

==== As API

see above

==== As End User

see above

== sensorAlternateId

=== Description

The sensorAlternateID is an endpointID representing the parent telemetry platform for a Virtual CU.

It can be used to on- and offboard new virtual CUs.

=== Where to find

==== As API

The value is delivered with any agrirouter message. To create message, take the context relevant endpointID. Context is the “source” of a message, e.g. a machine.

==== As End User

The id is an endpointID and can be found like the endpoint Id

== TeamsetContextId

=== Description

The TeamsetContextId is used to describe a unique combination of different machines and CUs attached to a CU or Virtual CU. It must be defined by the CU creating a URN:

----
 urn:hash::algoritm:value
----

The agrirouter team advices to use a hashing algorithm of either md5 or sha256.

Examples (the key is the hash of “Hello World”):

MD5:

----
 urn:hash::md5:b10a8db164e0754105b7a99be72e3fe5
----

Sha256:

----
 urn: hash::sha256:a591a6d40bf420404a011733cfb7b190d62c65bf0bcda32b57b277d9ad9f146e
----

=== Where to find

==== As API

The TeamsetContextId is sent in the envelope of every message. This information is forwarded through agrirouter so that it can be received by an app instance receiving this message.

==== As End User

An end user cannot see this value.

